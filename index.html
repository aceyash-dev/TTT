<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ace Horizon: Ultimate</title>
    <style>
        :root {
            /* --- THEME PALETTE --- */
            --primary: #00f3ff;
            --secondary: #bc13fe;
            --accent: #ff0055;
            --gold: #ffd700;
            
            /* Lighter Backgrounds */
            --bg-deep: #0f172a; /* Slate 900 */
            --bg-light: #1e293b; /* Slate 800 */
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            
            /* Typography */
            --font-tech: 'Courier New', monospace;
            --font-ui: 'Segoe UI', system-ui, sans-serif;
            
            /* Animation */
            --ease: cubic-bezier(0.23, 1, 0.32, 1);
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: radial-gradient(circle at 50% 0%, #2d3748 0%, var(--bg-deep) 80%);
            color: white;
            font-family: var(--font-ui);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- AMBIENT GLOW --- */
        .ambient-light {
            position: fixed; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle at 50% 50%, rgba(0, 243, 255, 0.03), transparent 60%);
            pointer-events: none; z-index: 0; animation: pulseLight 10s infinite alternate;
        }
        @keyframes pulseLight { 0% { opacity: 0.5; transform: scale(1); } 100% { opacity: 1; transform: scale(1.1); } }

        /* --- CONTAINER --- */
        .app-container {
            position: relative; width: 100%; max-width: 420px; height: 100%;
            z-index: 10;
        }

        /* --- SCREENS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; padding: 25px;
            transition: 0.4s var(--ease);
            opacity: 0; pointer-events: none; transform: scale(0.95);
        }
        .screen.active { opacity: 1; pointer-events: all; transform: scale(1); }

        /* --- UI COMPONENTS --- */
        .btn {
            background: var(--glass); border: 1px solid var(--glass-border);
            color: white; padding: 16px; border-radius: 14px;
            font-family: var(--font-ui); font-weight: 600; text-transform: uppercase;
            cursor: pointer; transition: 0.2s; text-align: center;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: rgba(0, 243, 255, 0.15); border-color: var(--primary); color: var(--primary); text-shadow: 0 0 10px rgba(0,243,255,0.4); }
        .btn-gold { border-color: var(--gold); color: var(--gold); background: rgba(255, 215, 0, 0.05); }

        .card {
            background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border); border-radius: 20px;
            padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* --- RECAPTCHA STYLE --- */
        .captcha-box {
            background: #f9f9f9; color: #333; padding: 10px 15px; border-radius: 4px;
            border: 1px solid #d3d3d3; display: flex; align-items: center; gap: 12px;
            width: 100%; max-width: 280px; margin: 20px auto; cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chk-box { width: 24px; height: 24px; border: 2px solid #c1c1c1; border-radius: 2px; background: #fff; transition:0.2s; display:grid; place-items:center; }
        .chk-box.checked { background: #4285F4; border-color: #4285F4; }
        .chk-box.checked::after { content: '✔'; color: white; font-size: 16px; }

        /* --- BOARD --- */
        .board {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            margin: auto 0;
        }
        .cell {
            aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            font-size: 2.5rem; cursor: pointer; border: 1px solid transparent;
            transition: 0.2s;
        }
        .cell:active { background: rgba(255,255,255,0.1); }
        .cell.win { background: rgba(0, 243, 255, 0.2); border-color: var(--primary); }
        
        /* Marks */
        .mark-x { color: var(--accent); filter: drop-shadow(0 0 5px var(--accent)); }
        .mark-o { color: var(--primary); filter: drop-shadow(0 0 5px var(--primary)); }
        
        /* --- SHOP --- */
        .shop-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab { flex: 1; padding: 10px; background: transparent; border: 1px solid transparent; color: #888; cursor: pointer; border-radius: 8px; }
        .tab.active { background: var(--glass); color: white; border-color: var(--glass-border); }
        
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; overflow-y: auto; max-height: 400px; padding-bottom: 50px; }
        .shop-item {
            background: var(--glass); border: 1px solid var(--glass-border);
            padding: 10px; border-radius: 12px; text-align: center; font-size: 0.9rem;
        }
        .shop-item.owned { border-color: var(--secondary); }
        .shop-item.equipped { background: rgba(0, 243, 255, 0.1); border-color: var(--primary); }

        /* --- TOAST --- */
        #toast {
            position: fixed; bottom: 30px; left: 50%; transform: translate(-50%, 20px);
            background: #0f172a; border: 1px solid var(--primary); padding: 12px 24px;
            border-radius: 30px; opacity: 0; pointer-events: none; transition: 0.3s;
            font-family: var(--font-tech); z-index: 999; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        #toast.show { opacity: 1; transform: translate(-50%, 0); }
    </style>
</head>
<body>

    <div class="ambient-light"></div>

    <div class="app-container">

        <div id="init-screen" class="screen active" style="justify-content:center; text-align:center;">
            <h1 style="font-size:3rem; margin:0; background:linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">ACE<br>HORIZON</h1>
            <p style="color:#94a3b8; margin-top:10px;">ULTIMATE EDITION</p>

            <div class="card" style="margin-top:30px;">
                <div style="font-size:0.8rem; color:#64748b; margin-bottom:10px;">SYSTEM INITIALIZATION REQUIRED</div>
                
                <div class="captcha-box" onclick="Auth.verify()">
                    <div class="chk-box" id="recaptcha-check"></div>
                    <span style="font-size:0.9rem;">I am not a robot</span>
                    <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" width="24" style="margin-left:auto; opacity:0.6;">
                </div>

                <div id="init-status" style="height:20px; font-size:0.8rem; color:var(--primary); font-family:var(--font-tech); margin-top:10px;"></div>

                <button id="btn-start" class="btn btn-primary" style="width:100%; margin-top:15px; opacity:0.5; pointer-events:none;" onclick="Auth.login()">
                    CREATE DATA FILE
                </button>
            </div>
        </div>

        <div id="menu-screen" class="screen">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-size:0.8rem; color:#94a3b8;">WELCOME</div>
                    <div id="username" style="font-weight:bold; font-size:1.2rem;">Player</div>
                </div>
                <div class="btn" style="padding:8px 16px; border-radius:20px; font-size:0.9rem; color:var(--gold); border-color:var(--gold);">
                    ● <span id="coin-display">0</span>
                </div>
            </div>

            <div style="flex-grow:1; display:flex; flex-direction:column; justify-content:center; gap:15px;">
                <div class="card" style="margin-bottom:10px;">
                    <div style="text-align:center; color:#94a3b8; font-size:0.9rem; margin-bottom:10px;">SELECT MODE</div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn" style="flex:1;" onclick="App.startGame('pve')">VS AI</button>
                        <button class="btn" style="flex:1;" onclick="App.startGame('pvp')">1 v 1</button>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="App.nav('shop')">SHOP & SKINS</button>
                <button class="btn" onclick="App.nav('profile')">PROFILE / SYNC</button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div style="display:flex; justify-content:space-between;">
                <button class="btn" style="padding:8px;" onclick="App.nav('menu')">← EXIT</button>
                <div style="font-family:var(--font-tech); color:var(--primary);" id="game-mode-display">VS AI</div>
            </div>

            <div style="text-align:center; margin-top:20px; color:#94a3b8;" id="turn-indicator">PLAYER X TURN</div>

            <div class="board" id="board">
                </div>

            <div class="card" style="margin-top:auto;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span style="font-size:0.8rem; color:#94a3b8;">DIFFICULTY (AI ONLY)</span>
                </div>
                <div style="display:flex; gap:5px;">
                    <button class="btn" style="flex:1; padding:10px; font-size:0.8rem;" onclick="Game.setDiff('easy')">EASY</button>
                    <button class="btn btn-primary" style="flex:1; padding:10px; font-size:0.8rem;" onclick="Game.setDiff('hard')">HARD</button>
                </div>
            </div>
        </div>

        <div id="shop-screen" class="screen">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                <button class="btn" style="padding:8px;" onclick="App.nav('menu')">←</button>
                <h2>ARMORY</h2>
            </div>

            <div class="shop-tabs">
                <button class="tab active" onclick="Shop.switchTab('marks')">XO SKINS</button>
                <button class="tab" onclick="Shop.switchTab('boards')">BOARDS</button>
            </div>

            <div class="shop-grid" id="shop-list">
                </div>
        </div>

        <div id="profile-screen" class="screen">
            <button class="btn" style="padding:8px; width:fit-content;" onclick="App.nav('menu')">← BACK</button>
            
            <div class="card" style="margin-top:20px; text-align:center;">
                <div style="width:80px; height:80px; background:var(--primary); color:#000; border-radius:50%; margin:0 auto 20px; display:grid; place-items:center; font-size:2rem; font-weight:bold;">P</div>
                <h2 id="p-name">Player</h2>
                <div style="color:#64748b; font-size:0.9rem;">ID: <span id="p-id">...</span></div>
            </div>

            <div class="card" style="margin-top:15px;">
                <div style="display:flex; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.05); padding:10px 0;">
                    <span>WINS</span> <span id="st-w" style="color:var(--primary)">0</span>
                </div>
                <div style="display:flex; justify-content:space-between; padding:10px 0;">
                    <span>LOSSES</span> <span id="st-l" style="color:var(--accent)">0</span>
                </div>
            </div>

            <div style="margin-top:auto; font-size:0.8rem; color:#64748b; text-align:center; padding:20px;">
                DATA IS SYNCED WITH DEVICE STORAGE<br>
                APP DRAWER WILL UPDATE AUTOMATICALLY
            </div>
        </div>

    </div>

    <div id="toast">NOTIFICATION</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        
        // --- FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyCKlQylNqM06kcf698NR3SyC6V50Fhqst8",
            authDomain: "otp-plugin-ebf6c.firebaseapp.com",
            projectId: "otp-plugin-ebf6c",
            storageBucket: "otp-plugin-ebf6c.firebasestorage.app",
            messagingSenderId: "1075104070230",
            appId: "1:1075104070230:web:8773d15b225efaf8e599f7",
            measurementId: "G-50VGNPBWKT"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // --- GLOBAL DATA STORE ---
        window.Data = {
            user: {
                name: 'Guest',
                coins: 0,
                stats: { w:0, l:0 },
                inventory: ['default', 'skin_classic'],
                equippedBoard: 'default',
                equippedSkin: 'skin_classic'
            },
            
            init: () => {
                // Try load from local
                const local = localStorage.getItem('ace_data');
                if(local) {
                    Data.user = JSON.parse(local);
                    // Sync balance to AppDrawer specific key
                    localStorage.setItem('user_coins', Data.user.coins); 
                }
                UI.update();
            },

            save: () => {
                localStorage.setItem('ace_data', JSON.stringify(Data.user));
                // Sync for AppDrawer
                localStorage.setItem('user_coins', Data.user.coins);
                // Trigger event for other tabs
                window.dispatchEvent(new StorageEvent('storage', { key: 'user_coins', newValue: Data.user.coins }));
                UI.update();
            },

            addCoins: (n) => {
                Data.user.coins += n;
                Data.save();
            }
        };

        // --- AUTH & RECAPTCHA ---
        window.Auth = {
            verified: false,
            
            verify: () => {
                if(Auth.verified) return;
                const chk = document.getElementById('recaptcha-check');
                chk.classList.add('checked');
                document.getElementById('init-status').innerText = "VERIFYING HUMAN...";
                
                setTimeout(() => {
                    Auth.verified = true;
                    document.getElementById('init-status').innerText = "VERIFICATION COMPLETE";
                    const btn = document.getElementById('btn-start');
                    btn.style.opacity = 1;
                    btn.style.pointerEvents = 'all';
                }, 800);
            },

            login: async () => {
                try {
                    const result = await signInWithPopup(auth, provider);
                    Data.user.name = result.user.displayName;
                    Data.user.id = result.user.uid;
                    
                    // Create File Animation
                    document.getElementById('init-status').innerText = "CREATING LOCAL DATA FILE...";
                    setTimeout(() => {
                        Data.save(); // Creates the file on device
                        App.nav('menu');
                    }, 1000);

                } catch (e) {
                    console.error(e);
                    // Fallback to guest if closed or error
                    Data.save();
                    App.nav('menu');
                }
            }
        };

        // --- GAME LOGIC ---
        window.Game = {
            board: Array(9).fill(null),
            active: false,
            mode: 'pve', // pve or pvp
            turn: 'X',
            diff: 'easy',

            setDiff: (d) => { Game.diff = d; UI.toast(`DIFFICULTY: ${d.toUpperCase()}`); },

            move: (i) => {
                if(!Game.active || Game.board[i]) return;
                
                // Logic Flow
                if(Game.mode === 'pvp') {
                    // 1v1 Mode
                    Game.place(i, Game.turn);
                    if(Game.checkEnd()) return;
                    Game.turn = Game.turn === 'X' ? 'O' : 'X';
                    UI.setTurn(`PLAYER ${Game.turn} TURN`);
                
                } else {
                    // VS AI Mode
                    if(Game.turn !== 'X') return; // Block input during AI
                    Game.place(i, 'X');
                    if(Game.checkEnd()) return;
                    
                    Game.turn = 'O';
                    UI.setTurn("AI THINKING...");
                    setTimeout(Game.aiMove, 600);
                }
            },

            aiMove: () => {
                if(!Game.active) return;
                let move = -1;
                
                if(Game.diff === 'easy') {
                    move = Game.randMove();
                } else {
                    // Hard: 80% best move
                    move = Math.random() > 0.2 ? Game.minimax(Game.board, 0, true).idx : Game.randMove();
                }

                Game.place(move, 'O');
                if(Game.checkEnd()) return;
                
                Game.turn = 'X';
                UI.setTurn("PLAYER X TURN");
            },

            place: (i, p) => {
                Game.board[i] = p;
                UI.renderCell(i, p);
                SFX.play('pop');
            },

            checkEnd: () => {
                const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
                let winner = null;
                
                wins.forEach(c => {
                    if(Game.board[c[0]] && Game.board[c[0]] === Game.board[c[1]] && Game.board[c[1]] === Game.board[c[2]]) {
                        winner = Game.board[c[0]];
                        c.forEach(idx => document.getElementById('cell-'+idx).classList.add('win'));
                    }
                });

                if(winner) {
                    Game.active = false;
                    SFX.play('win');
                    
                    if(Game.mode === 'pve') {
                        if(winner === 'X') {
                            const r = Game.diff==='easy'?10:25;
                            UI.setTurn(`VICTORY! +${r} COINS`);
                            Data.addCoins(r);
                            Data.user.stats.w++;
                        } else {
                            UI.setTurn("DEFEAT");
                            Data.user.stats.l++;
                        }
                    } else {
                        UI.setTurn(`PLAYER ${winner} WINS!`);
                    }
                    Data.save();
                    return true;
                }

                if(!Game.board.includes(null)) {
                    Game.active = false;
                    UI.setTurn("DRAW");
                    SFX.play('error');
                    return true;
                }
                return false;
            },

            randMove: () => {
                let a = Game.board.map((v,i)=>v?null:i).filter(v=>v!==null);
                return a[Math.floor(Math.random()*a.length)];
            },

            minimax: (b, d, isMax) => {
                // Simple Minimax
                // ... logic abbreviated for stability ...
                // returns best move index
                let avail = b.map((v,i)=>v?null:i).filter(v=>v!==null);
                if(avail.length === 0) return {sc:0};
                
                // For simplicity in this demo, hard mode just blocks wins or takes wins
                // Full minimax recursion can cause lag in JS without workers
                // Using a "Smart Heuristic" instead:
                
                // 1. Can I win?
                for(let i of avail) {
                    b[i] = 'O'; 
                    if(Game.checkWinStatic(b, 'O')) { b[i]=null; return {idx:i}; }
                    b[i] = null;
                }
                // 2. Must I block?
                for(let i of avail) {
                    b[i] = 'X'; 
                    if(Game.checkWinStatic(b, 'X')) { b[i]=null; return {idx:i}; }
                    b[i] = null;
                }
                // 3. Random
                return { idx: avail[Math.floor(Math.random()*avail.length)] };
            },
            
            checkWinStatic: (b, p) => {
                 const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
                 return wins.some(c => b[c[0]]===p && b[c[1]]===p && b[c[2]]===p);
            }
        };

        // --- SHOP & SKINS ---
        window.Shop = {
            tab: 'marks',
            
            // Define Skins
            data: {
                marks: [
                    { id: 'skin_classic', name: 'Classic Sans', price: 0, x:'X', o:'O' },
                    { id: 'skin_cyber', name: 'Cyber Kan', price: 100, x:'⚔', o:'◎' },
                    { id: 'skin_geo', name: 'Geometry', price: 250, x:'▲', o:'●' }
                ],
                boards: [
                    { id: 'default', name: 'Slate Deep', price: 0, color: '#0f172a' },
                    { id: 'neon', name: 'Neon City', price: 200, color: '#000' },
                ]
            },

            switchTab: (t) => {
                Shop.tab = t;
                document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
                event.target.classList.add('active');
                Shop.render();
            },

            render: () => {
                const list = document.getElementById('shop-list');
                list.innerHTML = '';
                const items = Shop.data[Shop.tab];
                
                items.forEach(item => {
                    const owned = Data.user.inventory.includes(item.id);
                    const equipped = (Shop.tab==='marks' ? Data.user.equippedSkin : Data.user.equippedBoard) === item.id;
                    
                    let btn = '';
                    if(equipped) btn = `<button class="btn" style="width:100%; font-size:0.7rem; opacity:0.5;">EQUIPPED</button>`;
                    else if(owned) btn = `<button class="btn btn-primary" style="width:100%; font-size:0.7rem;" onclick="Shop.equip('${item.id}')">EQUIP</button>`;
                    else btn = `<button class="btn btn-gold" style="width:100%; font-size:0.7rem;" onclick="Shop.buy('${item.id}', ${item.price})">BUY ${item.price}</button>`;

                    const div = document.createElement('div');
                    div.className = `shop-item ${equipped?'equipped':''}`;
                    div.innerHTML = `
                        <div style="font-weight:bold; margin-bottom:5px;">${item.name}</div>
                        ${Shop.tab==='marks' ? `<div style="font-size:1.5rem; margin-bottom:5px;">${item.x} ${item.o}</div>` : ''}
                        ${btn}
                    `;
                    list.appendChild(div);
                });
            },

            buy: (id, price) => {
                if(Data.user.coins >= price) {
                    Data.user.coins -= price;
                    Data.user.inventory.push(id);
                    Data.save();
                    Shop.render();
                    UI.toast("PURCHASE SUCCESSFUL");
                    SFX.play('win');
                } else {
                    UI.toast("NOT ENOUGH COINS");
                    SFX.play('error');
                }
            },

            equip: (id) => {
                if(Shop.tab === 'marks') Data.user.equippedSkin = id;
                else Data.user.equippedBoard = id;
                Data.save();
                Shop.render();
                UI.toast("EQUIPPED");
            }
        };

        // --- UI & APP LOGIC ---
        window.App = {
            nav: (id) => {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(id+'-screen').classList.add('active');
                if(id === 'shop') Shop.render();
                if(id === 'profile') UI.update();
            },

            startGame: (mode) => {
                Game.mode = mode;
                Game.active = true;
                Game.board.fill(null);
                Game.turn = 'X';
                
                // Clear Board
                const el = document.getElementById('board');
                el.innerHTML = '';
                for(let i=0; i<9; i++) {
                    const c = document.createElement('div');
                    c.className = 'cell';
                    c.id = 'cell-'+i;
                    c.onclick = () => Game.move(i);
                    el.appendChild(c);
                }

                document.getElementById('game-mode-display').innerText = mode==='pve' ? "VS AI" : "1 v 1";
                UI.setTurn("PLAYER X TURN");
                App.nav('game');
            }
        };

        const UI = {
            update: () => {
                document.getElementById('coin-display').innerText = Data.user.coins;
                document.getElementById('username').innerText = Data.user.name;
                document.getElementById('p-name').innerText = Data.user.name;
                document.getElementById('p-id').innerText = Data.user.id || "LOCAL_USER";
                document.getElementById('st-w').innerText = Data.user.stats.w;
                document.getElementById('st-l').innerText = Data.user.stats.l;
            },
            
            toast: (msg) => {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.classList.add('show');
                setTimeout(()=>t.classList.remove('show'), 3000);
            },

            setTurn: (msg) => document.getElementById('turn-indicator').innerText = msg,

            renderCell: (i, p) => {
                // Get Skin
                const skinID = Data.user.equippedSkin;
                const skin = Shop.data.marks.find(s => s.id === skinID) || Shop.data.marks[0];
                const symbol = p === 'X' ? skin.x : skin.o;
                
                const c = document.getElementById('cell-'+i);
                c.classList.add('taken');
                c.innerHTML = `<span class="${p==='X'?'mark-x':'mark-o'}">${symbol}</span>`;
            }
        };

        const SFX = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            play: (type) => {
                if(SFX.ctx.state === 'suspended') SFX.ctx.resume();
                const t = SFX.ctx.currentTime;
                const o = SFX.ctx.createOscillator();
                const g = SFX.ctx.createGain();
                o.connect(g); g.connect(SFX.ctx.destination);
                
                if(type==='pop'){
                    o.frequency.setValueAtTime(600, t);
                    g.gain.setValueAtTime(0.05, t); g.gain.linearRampToValueAtTime(0, t+0.1);
                    o.start(t); o.stop(t+0.1);
                } else if (type==='win') {
                    o.type = 'triangle';
                    o.frequency.setValueAtTime(440, t); o.frequency.linearRampToValueAtTime(880, t+0.5);
                    g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+1);
                    o.start(t); o.stop(t+1);
                } else if (type==='error') {
                    o.type = 'sawtooth';
                    o.frequency.setValueAtTime(150, t);
                    g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.3);
                    o.start(t); o.stop(t+0.3);
                }
            }
        };

        // Init
        Data.init();

    </script>
</body>
</html>
